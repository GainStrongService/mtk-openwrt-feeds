From 320a3bbc91a6213b6ec75ecd9a7f988c80369968 Mon Sep 17 00:00:00 2001
From: Shayne Chen <shayne.chen@mediatek.com>
Date: Mon, 22 Dec 2025 14:33:24 +0800
Subject: [PATCH 103/105] mtk: mt76: mt7996: fix deflink.phy

Always assign a value to prevent crash.

Signed-off-by: Shayne Chen <shayne.chen@mediatek.com>
---
 mt7996/main.c | 12 +++++++-----
 1 file changed, 7 insertions(+), 5 deletions(-)

diff --git a/mt7996/main.c b/mt7996/main.c
index 8dceeb981..dc1e2ff36 100644
--- a/mt7996/main.c
+++ b/mt7996/main.c
@@ -606,8 +606,13 @@ static int mt7996_add_interface(struct ieee80211_hw *hw,
 	for (i = 0; i < MT7996_MAX_RADIOS; i++) {
 		struct mt7996_phy *phy = dev->radio_phy[i];
 
-		if (!phy || !(wdev->radio_mask & BIT(i)) ||
-		    test_bit(MT76_STATE_RUNNING, &phy->mt76->state))
+		if (!phy || !(wdev->radio_mask & BIT(i)))
+			continue;
+
+		if (!mvif->deflink.phy)
+			mvif->deflink.phy = phy;
+
+		if (test_bit(MT76_STATE_RUNNING, &phy->mt76->state))
 			continue;
 
 		err = mt7996_run(phy);
@@ -618,9 +623,6 @@ static int mt7996_add_interface(struct ieee80211_hw *hw,
 			mt7996_set_monitor(phy, true);
 			phy->mt76->monitor_vif = vif;
 		}
-
-		if (!mvif->deflink.phy)
-			mvif->deflink.phy = phy;
 	}
 
 	mt76_vif_init(vif, &mvif->mt76);
-- 
2.45.2

