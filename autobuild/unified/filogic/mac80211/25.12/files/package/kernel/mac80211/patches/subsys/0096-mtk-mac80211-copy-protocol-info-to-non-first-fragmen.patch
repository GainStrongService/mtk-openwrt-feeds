From 0d77d0ac54c9d73550db87a2e69057ea6d2e14c0 Mon Sep 17 00:00:00 2001
From: Benjamin Lin <benjamin-jw.lin@mediatek.com>
Date: Fri, 9 May 2025 15:37:25 +0800
Subject: [PATCH 096/128] mtk: mac80211: copy protocol info to non-first
 fragments

Copy protocol info from first fragment to remaining ones.
With protocol info, MT76 may let EAPOL fragments bypass SDO admission control to prevent connection failure.

Signed-off-by: Benjamin Lin <benjamin-jw.lin@mediatek.com>
---
 net/mac80211/tx.c | 1 +
 1 file changed, 1 insertion(+)

diff --git a/net/mac80211/tx.c b/net/mac80211/tx.c
index 7d587088..a8416d66 100644
--- a/net/mac80211/tx.c
+++ b/net/mac80211/tx.c
@@ -936,6 +936,7 @@ static int ieee80211_fragment(struct ieee80211_tx_data *tx,
 		skb_copy_queue_mapping(tmp, skb);
 		tmp->priority = skb->priority;
 		tmp->dev = skb->dev;
+		tmp->protocol = skb->protocol;
 
 		/* copy header and data */
 		skb_put_data(tmp, skb->data, hdrlen);
-- 
2.45.2

