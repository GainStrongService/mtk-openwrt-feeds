From 588b9db9280a978e78ae4e949ebb8dd5a08b5d05 Mon Sep 17 00:00:00 2001
From: Peter Chiu <chui-hao.chiu@mediatek.com>
Date: Thu, 13 Nov 2025 11:27:06 +0800
Subject: [PATCH 045/105] mtk: mt76: mt7996: add configuration to suppot wed
 and rro for mt7990 chipset

Signed-off-by: Peter Chiu <chui-hao.chiu@mediatek.com>
---
 mt7996/dma.c  |  2 +-
 mt7996/mmio.c | 17 +++++++++++++++--
 2 files changed, 16 insertions(+), 3 deletions(-)

diff --git a/mt7996/dma.c b/mt7996/dma.c
index 274b273df..c84f37415 100644
--- a/mt7996/dma.c
+++ b/mt7996/dma.c
@@ -827,7 +827,7 @@ int mt7996_dma_init(struct mt7996_dev *dev)
 		if (ret)
 			return ret;
 
-		if (is_mt7992(&dev->mt76)) {
+		if (!is_mt7996(&dev->mt76)) {
 			dev->mt76.q_rx[MT_RXQ_RRO_BAND1].flags =
 				MT_WED_RRO_Q_DATA(1) | MT_QFLAG_WED_RRO_EN;
 			if (mtk_wed_device_active(wed) &&
diff --git a/mt7996/mmio.c b/mt7996/mmio.c
index 277978add..d0e34f106 100644
--- a/mt7996/mmio.c
+++ b/mt7996/mmio.c
@@ -499,11 +499,16 @@ int mt7996_mmio_wed_init(struct mt7996_dev *dev, void *pdev_ptr,
 				wed->wlan.wpdma_txfree = wed->wlan.phy_base + hif1_ofs +
 							 MT_RXQ_RING_BASE(0) +
 							 MT7996_RXQ_TXFREE2 * MT_RING_SIZE;
-			} else {
+			} else if (is_mt7992(&dev->mt76)) {
 				wed->wlan.txfree_tbit = ffs(MT_INT_RX_TXFREE_BAND1_EXT) - 1;
 				wed->wlan.wpdma_txfree = wed->wlan.phy_base + hif1_ofs +
 							 MT_RXQ_RING_BASE(0) +
 							 MT7996_RXQ_MCU_WA_EXT * MT_RING_SIZE;
+			} else {
+				wed->wlan.txfree_tbit = ffs(MT_INT_RX_TXFREE_BAND1_MT7990) - 1;
+				wed->wlan.wpdma_txfree = wed->wlan.phy_base + hif1_ofs +
+							 MT_RXQ_RING_BASE(0) +
+							 MT7990_RXQ_TXFREE1 * MT_RING_SIZE;
 			}
 		} else {
 			wed->wlan.wpdma_txfree = wed->wlan.phy_base + hif1_ofs +
@@ -584,10 +589,18 @@ int mt7996_mmio_wed_init(struct mt7996_dev *dev, void *pdev_ptr,
 							 MT7996_RXQ_MCU_WA_MAIN * MT_RING_SIZE;
 				wed->wlan.txfree_tbit = ffs(MT_INT_RX_DONE_WA_MAIN) - 1;
 			}
-		} else {
+		} else if (is_mt7992(&dev->mt76)) {
 			wed->wlan.txfree_tbit = ffs(MT_INT_RX_DONE_WA_MAIN) - 1;
 			wed->wlan.wpdma_txfree = wed->wlan.phy_base + MT_RXQ_RING_BASE(0) +
 						  MT7996_RXQ_MCU_WA_MAIN * MT_RING_SIZE;
+			if (dev->hif2)
+				wed->wlan.id = MT7992_DEVICE_ID;
+		} else {
+			wed->wlan.txfree_tbit = ffs(MT_INT_RX_TXFREE_BAND0_MT7990) - 1;
+			wed->wlan.wpdma_txfree = wed->wlan.phy_base + MT_RXQ_RING_BASE(0) +
+						 MT7990_RXQ_TXFREE0 * MT_RING_SIZE;
+			if (dev->hif2)
+				wed->wlan.id = MT7990_DEVICE_ID;
 		}
 		dev->mt76.rx_token_size = MT7996_TOKEN_SIZE + wed->wlan.rx_npkt;
 
-- 
2.45.2

