From ad85f2cda535d5b36b1eb76aaf6792fc0f05ba86 Mon Sep 17 00:00:00 2001
From: Michael-CY Lee <michael-cy.lee@mediatek.com>
Date: Fri, 8 Aug 2025 08:39:03 +0800
Subject: [PATCH 204/254] mtk: hostapd: properly assign sta to NULL in
 handle_auth() to prevent use-after-free issue

Signed-off-by: Michael-CY Lee <michael-cy.lee@mediatek.com>
---
 src/ap/ieee802_11.c | 1 +
 1 file changed, 1 insertion(+)

diff --git a/src/ap/ieee802_11.c b/src/ap/ieee802_11.c
index 5b36e6537..9806f7347 100644
--- a/src/ap/ieee802_11.c
+++ b/src/ap/ieee802_11.c
@@ -3498,6 +3498,7 @@ static void handle_auth(struct hostapd_data *hapd,
 			hostapd_ml_handle_disconnect(hapd, sta, mgmt, false);
 			hostapd_drv_sta_remove(hapd, sa);
 			resp = WLAN_STATUS_UNSPECIFIED_FAILURE;
+			sta = NULL;
 			goto fail;
 		}
 #endif /* CONFIG_IEEE80211BE */
-- 
2.45.2

