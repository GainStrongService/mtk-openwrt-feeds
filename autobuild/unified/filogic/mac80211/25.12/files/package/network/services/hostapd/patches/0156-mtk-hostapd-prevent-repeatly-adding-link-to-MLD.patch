From 6bd5c72bd4bcf1c97a8ab43f2d135b7a3ecd62ca Mon Sep 17 00:00:00 2001
From: Michael-CY Lee <michael-cy.lee@mediatek.com>
Date: Wed, 19 Mar 2025 09:53:33 +0800
Subject: [PATCH 156/254] mtk: hostapd: prevent repeatly adding link to MLD

Chage "active_links" to "valid_links"

Signed-off-by: Michael-CY Lee <michael-cy.lee@mediatek.com>
---
 src/ap/hostapd.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/src/ap/hostapd.c b/src/ap/hostapd.c
index 3e2e48e5a..8714318dd 100644
--- a/src/ap/hostapd.c
+++ b/src/ap/hostapd.c
@@ -5686,7 +5686,7 @@ int hostapd_mld_add_link(struct hostapd_data *hapd)
 {
 	struct hostapd_mld *mld = hapd->mld;
 
-	if (!hapd->conf->mld_ap)
+	if (!hapd->conf->mld_ap || (mld->valid_links & BIT(hapd->mld_link_id)))
 		return 0;
 
 	/* Should not happen */
-- 
2.45.2

