From 82a2e50786a27a658e9e24befef5e3aa5f2bb437 Mon Sep 17 00:00:00 2001
From: StanleyYP Wang <StanleyYP.Wang@mediatek.com>
Date: Tue, 29 Apr 2025 15:34:20 +0800
Subject: [PATCH 194/236] mtk: hostapd: avoid adding empty channel switch
 wrapper IE

Avoid adding empty channel switch wrapper IE

Signed-off-by: StanleyYP Wang <StanleyYP.Wang@mediatek.com>
---
 src/ap/ieee802_11.c | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/src/ap/ieee802_11.c b/src/ap/ieee802_11.c
index c78dd7104..5bc5b9a6d 100644
--- a/src/ap/ieee802_11.c
+++ b/src/ap/ieee802_11.c
@@ -8122,6 +8122,12 @@ u8 * hostapd_eid_chsw_wrapper(struct hostapd_data *hapd, u8 *eid)
 #endif /* CONFIG_IEEE80211BE */
 
 	*eid_len_offset = (eid - eid_len_offset) - 1;
+	/* channel switch wrapper is empty, clear its tag */
+	if (!(*eid_len_offset)) {
+		eid -= 2;
+		*eid = 0;
+	}
+
 	return eid;
 }
 
-- 
2.45.2

