From 65ddaee9aabaedd7b3e942cf3ea4995804d4b2ea Mon Sep 17 00:00:00 2001
From: Michael-CY Lee <michael-cy.lee@mediatek.com>
Date: Fri, 8 Aug 2025 08:39:03 +0800
Subject: [PATCH 229/236] mtk: hostapd: properly assign sta to NULL in
 handle_auth() to prevent use-after-free issue

Signed-off-by: Michael-CY Lee <michael-cy.lee@mediatek.com>
---
 src/ap/ieee802_11.c | 1 +
 1 file changed, 1 insertion(+)

diff --git a/src/ap/ieee802_11.c b/src/ap/ieee802_11.c
index d720c1176..720f8aa5f 100644
--- a/src/ap/ieee802_11.c
+++ b/src/ap/ieee802_11.c
@@ -3456,6 +3456,7 @@ static void handle_auth(struct hostapd_data *hapd,
 			hostapd_ml_handle_disconnect(hapd, sta, mgmt, false);
 			hostapd_drv_sta_remove(hapd, sa);
 			resp = WLAN_STATUS_UNSPECIFIED_FAILURE;
+			sta = NULL;
 			goto fail;
 		}
 #endif /* CONFIG_IEEE80211BE */
-- 
2.45.2

