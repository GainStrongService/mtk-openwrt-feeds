// SPDX-License-Identifier: (GPL-2.0 OR MIT)

/dts-v1/;
/plugin/;

/ {
	fragment@0 {
		target-path = "/soc/spi@11007800";
		__overlay__ {
			pinctrl-names = "default";
			pinctrl-0 = <&spi0_flash_pins>;
			status = "okay";

			flash@0 {
				compatible = "spi-nand";
				reg = <0>;
				spi-max-frequency = <52000000>;
				spi-tx-bus-width = <4>;
				spi-rx-bus-width = <4>;

				partitions {
					compatible = "fixed-partitions";
					#address-cells = <1>;
					#size-cells = <1>;

					partition@0 {
						label = "BL2";
						reg = <0x00000 0x0200000>;
						read-only;
					};

					partition@200000 {
						label = "ubi";
						reg = <0x0200000 0x7e00000>;
						compatible = "linux,ubi";

						volumes {
							ubi-volume-ubootenv {
								volname = "ubootenv";
								nvmem-layout {
									compatible = "u-boot,env-redundant-bool";
								};
							};

							ubi-volume-ubootenv2 {
								volname = "ubootenv2";
								nvmem-layout {
									compatible = "u-boot,env-redundant-bool";
								};
							};

							ubi_factory: ubi-volume-factory {
								volname = "factory";

								nvmem-layout {
									compatible = "fixed-layout";
									#address-cells = <1>;
									#size-cells = <1>;

									eeprom_wmac: eeprom@0 {
										reg = <0x0 0x1e00>;
									};

									gmac2_mac: eeprom@fffee {
										reg = <0xfffee 0x6>;
									};

									gmac1_mac: eeprom@ffffa {
										reg = <0xffffa 0x6>;
									};

									gmac0_mac: eeprom@ffff4 {
										reg = <0xffff4 0x6>;
									};
								};
							};

							ubi_root: ubi-volume-fit {
								volname = "fit";
							};
						};
					};
				};
			};
		};
	};

	fragment@1 {
		target-path = "/chosen";
		__overlay__ {
			rootdisk-spim-nand = <&ubi_root>;
		};
	};

	fragment@2 {
		target = <&pcie0>;
		__overlay__ {
			slot0: pcie@0,0 {
				reg = <0x0000 0 0 0 0>;

				wifi@0,0 {
					compatible = "mediatek,mt76";
					reg = <0x0000 0 0 0 0>;
					nvmem-cell-names = "eeprom";
					nvmem-cells = <&eeprom_wmac>;
				};
			};
		};
	};

	fragment@3 {
		target = <&gmac0>;
		__overlay__ {
			nvmem-cell-names = "mac-address";
			nvmem-cells = <&gmac0_mac>;
		};
	};

	fragment@4 {
		target = <&gmac1>;
		__overlay__ {
			nvmem-cell-names = "mac-address";
			nvmem-cells = <&gmac1_mac>;
		};
	};

	fragment@5 {
		target = <&gmac2>;
		__overlay__ {
			nvmem-cell-names = "mac-address";
			nvmem-cells = <&gmac2_mac>;
		};
	};

	fragment@6 {
		target-path = "/";
		__overlay__ {
			mediatek,no-split-fitrw;
		};
	};
};
